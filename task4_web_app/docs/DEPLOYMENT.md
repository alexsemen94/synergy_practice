# Руководство по развертыванию туристической системы

## Обзор
Данное руководство описывает процесс развертывания веб-приложения "Система управления туристическими турами" с использованием Delphi 10.2, MS Internet Information Server (IIS) и MS SQL Server.

## Требования к системе

### Минимальные требования
- **Операционная система**: Windows 10/11 или Windows Server 2019+
- **Процессор**: Intel Core i3 или AMD Ryzen 3 (2.0 ГГц)
- **Оперативная память**: 4 GB RAM
- **Свободное место на диске**: 10 GB
- **Сеть**: Подключение к интернету для загрузки зависимостей

### Рекомендуемые требования
- **Операционная система**: Windows 11 или Windows Server 2022
- **Процессор**: Intel Core i5 или AMD Ryzen 5 (3.0 ГГц)
- **Оперативная память**: 8 GB RAM
- **Свободное место на диске**: 20 GB SSD
- **Сеть**: Высокоскоростное подключение к интернету

## Установка компонентов

### 1. Установка MS SQL Server

#### Шаг 1: Загрузка SQL Server
1. Перейдите на официальный сайт Microsoft: https://www.microsoft.com/sql-server
2. Скачайте SQL Server Developer Edition (бесплатная версия для разработки)
3. Запустите установщик

#### Шаг 2: Настройка установки
1. Выберите "Basic" для простой установки
2. Укажите путь установки (рекомендуется: `C:\Program Files\Microsoft SQL Server`)
3. Настройте аутентификацию:
   - **Режим аутентификации**: Mixed Mode
   - **SA пароль**: Создайте надежный пароль
4. Завершите установку

#### Шаг 3: Установка SQL Server Management Studio (SSMS)
1. Скачайте SSMS с официального сайта Microsoft
2. Установите SSMS
3. Подключитесь к серверу используя:
   - **Server name**: `localhost` или `.\SQLEXPRESS`
   - **Authentication**: SQL Server Authentication
   - **Login**: `sa`
   - **Password**: пароль, указанный при установке

### 2. Установка MS Internet Information Server (IIS)

#### Шаг 1: Включение IIS
1. Откройте "Панель управления" → "Программы и компоненты"
2. Нажмите "Включение или отключение компонентов Windows"
3. Установите флажки:
   - [x] Internet Information Services
   - [x] World Wide Web Services
   - [x] Application Development Features
   - [x] ASP.NET 4.8
   - [x] .NET Extensibility 4.8
   - [x] ISAPI Extensions
   - [x] ISAPI Filters
4. Нажмите "OK" и дождитесь завершения установки

#### Шаг 2: Настройка IIS
1. Откройте "Диспетчер служб IIS"
2. В левой панели выберите ваш сервер
3. В правой панели нажмите "Дополнительные параметры"
4. Убедитесь, что включены:
   - **Версия .NET Framework**: v4.0
   - **Режим пула приложений**: Integrated

### 3. Установка Delphi 10.2

#### Шаг 1: Загрузка и установка
1. Скачайте Delphi 10.2 с официального сайта Embarcadero
2. Запустите установщик
3. Выберите компоненты для установки:
   - [x] Delphi VCL
   - [x] Delphi FireMonkey
   - [x] Delphi Web Development
   - [x] Database Components
4. Завершите установку

#### Шаг 2: Настройка Delphi
1. Запустите Delphi 10.2
2. Перейдите в "Tools" → "Options"
3. В разделе "Environment Options" → "Library" добавьте пути к компонентам
4. В разделе "Database" → "Connections" настройте подключение к SQL Server

## Создание базы данных

### Шаг 1: Создание базы данных
1. Откройте SQL Server Management Studio
2. Подключитесь к серверу
3. В Object Explorer правой кнопкой мыши нажмите на "Databases"
4. Выберите "New Database"
5. Введите имя: `TourismDB`
6. Нажмите "OK"

### Шаг 2: Выполнение SQL скрипта
1. В SSMS откройте файл `database/tourism_db.sql`
2. Убедитесь, что выбрана база данных `TourismDB`
3. Нажмите "Execute" (F5)
4. Проверьте, что все таблицы созданы успешно

### Шаг 3: Проверка данных
1. В Object Explorer разверните `TourismDB` → `Tables`
2. Убедитесь, что созданы таблицы:
   - Countries
   - Cities
   - Hotels
   - TourTypes
   - Tours
   - Clients
   - Bookings

## Создание Delphi Web Application

### Шаг 1: Создание нового проекта
1. В Delphi выберите "File" → "New" → "Other"
2. Выберите "Web Application" → "Web App Debugger executable"
3. Сохраните проект в папке `src/`

### Шаг 2: Настройка компонентов
1. Добавьте на форму компоненты:
   - `TWebModule` - для обработки HTTP запросов
   - `TSQLConnection` - для подключения к базе данных
   - `TSQLQuery` - для выполнения SQL запросов
   - `TDataSetProvider` - для предоставления данных

### Шаг 3: Настройка подключения к базе данных
1. Настройте `TSQLConnection`:
   - **DriverName**: `MSSQL`
   - **Server**: `localhost` или имя вашего сервера
   - **Database**: `TourismDB`
   - **User_Name**: `sa`
   - **Password**: пароль SA
2. Протестируйте подключение

### Шаг 4: Создание API endpoints
1. В `TWebModule` создайте действия для:
   - `GET /api/tours` - получение списка туров
   - `POST /api/tours` - создание нового тура
   - `PUT /api/tours/{id}` - обновление тура
   - `DELETE /api/tours/{id}` - удаление тура
   - `GET /api/dashboard/stats` - статистика дашборда

### Шаг 5: Компиляция проекта
1. Нажмите F9 для компиляции и запуска
2. Убедитесь, что приложение запустилось без ошибок
3. Проверьте, что веб-сервер доступен по адресу `http://localhost:8080`

## Развертывание веб-интерфейса

### Шаг 1: Копирование файлов
1. Скопируйте содержимое папки `web/` в папку IIS:
   - По умолчанию: `C:\inetpub\wwwroot\tourism\`
2. Убедитесь, что все файлы скопированы:
   - HTML файлы
   - CSS файлы
   - JavaScript файлы
   - Изображения (если есть)

### Шаг 2: Настройка IIS
1. Откройте "Диспетчер служб IIS"
2. Создайте новый сайт:
   - **Site name**: TourismSystem
   - **Physical path**: `C:\inetpub\wwwroot\tourism\`
   - **Port**: 80 (или другой свободный порт)
3. Настройте пул приложений:
   - **.NET CLR Version**: v4.0
   - **Managed Pipeline Mode**: Integrated

### Шаг 3: Настройка MIME типов
1. В свойствах сайта выберите "HTTP Headers"
2. Нажмите "MIME Types"
3. Убедитесь, что добавлены:
   - `.js` → `application/javascript`
   - `.css` → `text/css`
   - `.json` → `application/json`

## Настройка CORS (если необходимо)

### Для локальной разработки
1. В Delphi добавьте заголовки CORS в ответы:
```delphi
Response.CustomHeaders.Values['Access-Control-Allow-Origin'] := '*';
Response.CustomHeaders.Values['Access-Control-Allow-Methods'] := 'GET, POST, PUT, DELETE, OPTIONS';
Response.CustomHeaders.Values['Access-Control-Allow-Headers'] := 'Content-Type';
```

### Для продакшена
1. Настройте конкретные домены вместо `*`
2. Ограничьте методы HTTP если необходимо

## Тестирование системы

### Шаг 1: Проверка базы данных
1. В SSMS выполните тестовые запросы:
```sql
SELECT * FROM Tours;
SELECT * FROM Clients;
SELECT * FROM Bookings;
```

### Шаг 2: Проверка веб-интерфейса
1. Откройте браузер
2. Перейдите по адресу: `http://localhost/tourism/`
3. Проверьте все страницы:
   - Главная страница
   - Управление турами
   - Управление клиентами
   - Бронирования
   - Отчеты

### Шаг 3: Проверка API
1. Используйте Postman или браузер для тестирования API
2. Проверьте все endpoints:
   - `GET /api/tours`
   - `POST /api/tours`
   - `GET /api/dashboard/stats`

## Настройка безопасности

### Шаг 1: Настройка аутентификации
1. В Delphi добавьте проверку аутентификации
2. Используйте токены JWT или сессии
3. Настройте роли пользователей (админ, менеджер, оператор)

### Шаг 2: Настройка HTTPS
1. Получите SSL сертификат
2. Настройте HTTPS в IIS
3. Перенаправляйте HTTP на HTTPS

### Шаг 3: Настройка файрвола
1. Откройте только необходимые порты
2. Настройте правила для доступа к базе данных
3. Ограничьте доступ к административным функциям

## Мониторинг и обслуживание

### Шаг 1: Логирование
1. Настройте логирование в Delphi
2. Настройте логи IIS
3. Настройте логи SQL Server

### Шаг 2: Резервное копирование
1. Настройте автоматическое резервное копирование базы данных
2. Настройте резервное копирование веб-файлов
3. Тестируйте восстановление из резервных копий

### Шаг 3: Обновления
1. Регулярно обновляйте Windows
2. Обновляйте SQL Server
3. Обновляйте Delphi компоненты

## Устранение неполадок

### Частые проблемы

#### Проблема: Не удается подключиться к базе данных
**Решение:**
1. Проверьте, что SQL Server запущен
2. Проверьте настройки подключения
3. Убедитесь, что порт 1433 открыт

#### Проблема: Веб-страницы не загружаются
**Решение:**
1. Проверьте, что IIS запущен
2. Проверьте права доступа к папке
3. Проверьте настройки MIME типов

#### Проблема: API возвращает ошибки
**Решение:**
1. Проверьте логи Delphi приложения
2. Проверьте подключение к базе данных
3. Проверьте CORS настройки

## Контакты и поддержка

### Техническая поддержка
- **Email**: support@toursystem.ru
- **Телефон**: +7 (495) 123-45-67
- **Документация**: https://docs.toursystem.ru

### Полезные ссылки
- [Delphi Documentation](https://docwiki.embarcadero.com/)
- [IIS Documentation](https://docs.microsoft.com/iis/)
- [SQL Server Documentation](https://docs.microsoft.com/sql/)

---

**Примечание**: Данное руководство предназначено для развертывания системы в среде разработки. Для продакшена необходимо дополнительно настроить безопасность, производительность и мониторинг.
